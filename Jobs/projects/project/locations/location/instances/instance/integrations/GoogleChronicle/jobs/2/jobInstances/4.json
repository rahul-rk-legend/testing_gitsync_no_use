{
    "name": "projects/project/locations/location/instances/instance/integrations/GoogleChronicle/jobs/2/jobInstances/4",
    "id": 0,
    "job": "Google Chronicle Alerts Creator Job",
    "integration": "GoogleChronicle",
    "createTime": 1771586058131,
    "updateTime": 1771586058131,
    "custom": true,
    "script": "from SiemplifyJob import SiemplifyJob\nfrom SiemplifyUtils import output_handler\n\nfrom TIPCommon.extraction import extract_action_param\n\nfrom consts import (\n    ALERTS_CREATOR_BATCH_SIZE,\n    ALERTS_CREATOR_MAX_API_RETRIES,\n    ALERTS_CREATOR_MAX_ITERATIONS,\n    ALERTS_CREATOR_RETRY_TIME_DELTA_MS,\n    ALERTS_CREATOR_SCRIPT_NAME,\n)\nfrom utils import retry_decorator, validate_alerts_creator_support\nfrom GoogleChronicleManagerV2 import GoogleChronicleManagerV2\n\n\n\nclass JobParametersParser:\n    \"\"\"This class parses the input parameters of the job.\"\"\"\n\n    def __init__(self, siemplify_):\n        self.environment = JobParametersParser.parse_environment(siemplify_)\n        self.api_root = JobParametersParser.parse_api_root(siemplify_)\n        self.creds = JobParametersParser.parse_creds(siemplify_)\n        self.verify_ssl = JobParametersParser.parse_verify_ssl(siemplify_)\n        self.workload_identity_email = (\n            JobParametersParser.parse_workload_identity_email(siemplify_)\n        )\n\n    @staticmethod\n    def parse_environment(siemplify):\n        return extract_action_param(\n            siemplify=siemplify,\n            param_name=\"Environment\",\n            is_mandatory=True,\n            print_value=True,\n            default_value=\"Default Environment\",\n        )\n\n    @staticmethod\n    def parse_api_root(siemplify):\n        return extract_action_param(\n            siemplify=siemplify,\n            param_name=\"API Root\",\n            is_mandatory=True,\n            print_value=True,\n        )\n\n    @staticmethod\n    def parse_creds(siemplify):\n        return extract_action_param(\n            siemplify=siemplify,\n            param_name=\"User's Service Account\",\n            is_mandatory=False,\n            print_value=False,\n        )\n\n    @staticmethod\n    def parse_verify_ssl(siemplify):\n        return extract_action_param(\n            siemplify=siemplify,\n            param_name=\"Verify SSL\",\n            default_value=True,\n            input_type=bool,\n            print_value=True,\n        )\n\n    @staticmethod\n    def parse_workload_identity_email(siemplify):\n        return extract_action_param(\n            siemplify=siemplify,\n            param_name=\"Workload Identity Email\",\n            print_value=False,\n        )\n\n\ndef log_fetched_alerts(siemplify, fetched_alerts):\n    \"\"\"Log fetched SOAR alerts group identifiers\"\"\"\n    ids = [alert.get(\"alert_group_identifier\") for alert in fetched_alerts]\n    siemplify.LOGGER.info(f\"Fetched the following SOAR alerts: {ids}\")\n\n\ndef verify_soar_sync_results(siemplify, sync_results):\n    \"\"\"Count failed SOAR sync status updates and warn about them.\"\"\"\n    failed = 0\n    for sync_result in sync_results:\n        if not sync_result.updated_in_soar:\n            siemplify.LOGGER.warn(\n                \"SOAR has failed updating the status of alert\"\n                f\" {sync_result.alert_group_identifier}\"\n            )\n        if not sync_result.created_in_siem or (\n            sync_result.created_in_siem and not sync_result.updated_in_soar\n        ):\n            failed += 1\n\n    return failed\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyJob()\n    siemplify.script_name = ALERTS_CREATOR_SCRIPT_NAME\n    siemplify.LOGGER.info(\"--------------- JOB STARTED ---------------\")\n    job_parameters_parser = JobParametersParser(siemplify)\n    environments = (\n        [job_parameters_parser.environment]\n        if job_parameters_parser.environment\n        else None\n    )\n    batch_size = ALERTS_CREATOR_BATCH_SIZE\n    max_iterations = ALERTS_CREATOR_MAX_ITERATIONS\n    siemplify.LOGGER.info(\"----------------- Main - Started -----------------\")\n\n    @retry_decorator(\n        ALERTS_CREATOR_MAX_API_RETRIES,\n        ALERTS_CREATOR_RETRY_TIME_DELTA_MS,\n        siemplify.LOGGER\n    )\n    def fetch_new_alerts_to_sync(batch_size, environments):\n        return siemplify.fetch_new_alerts_to_sync(batch_size, environments)\n\n    @retry_decorator(\n        ALERTS_CREATOR_MAX_API_RETRIES,\n        ALERTS_CREATOR_RETRY_TIME_DELTA_MS,\n        siemplify.LOGGER\n    )\n    def update_new_alerts_sync_status(request_sync_results, environments):\n        return siemplify.update_new_alerts_sync_status(\n            request_sync_results,\n            environments\n        )\n\n    try:\n        validate_alerts_creator_support(siemplify)\n        manager = GoogleChronicleManagerV2.create_manager_instance(\n            user_service_account=job_parameters_parser.creds,\n            workload_identity_email=job_parameters_parser.workload_identity_email,\n            chronicle_soar=siemplify,\n            api_root=job_parameters_parser.api_root,\n            verify_ssl=job_parameters_parser.verify_ssl,\n        )\n        manager.test_connectivity()\n\n        total_synced = 0\n\n        for i in range(max_iterations):\n            siemplify.LOGGER.info(f\"Starting {i + 1}/{max_iterations} fetch attempt\")\n            siemplify.LOGGER.info(\n                f\"Fetching up to {batch_size} new alerts from the SOAR\"\n            )\n            new_alerts = fetch_new_alerts_to_sync(batch_size, environments)\n\n            new_alerts_count = len(new_alerts)\n            siemplify.LOGGER.info(f\"{new_alerts_count} SOAR alerts were fetched\")\n            if not new_alerts_count:\n                siemplify.LOGGER.info(\"No new SOAR alerts were found. Stopping...\")\n                break\n            log_fetched_alerts(siemplify, new_alerts)\n\n            siemplify.LOGGER.info(\"Dispatching SOAR alerts to SIEM\")\n            request_soar_alerts = manager.convert_new_alerts_to_siem_alerts(new_alerts)\n            response_soar_alerts = manager.batch_create_alerts_in_siem(\n                request_soar_alerts\n            )\n\n            siemplify.LOGGER.info(\"Updating SOAR with SIEM response\")\n            request_sync_results = manager.convert_siem_alerts_to_sync_results(\n                response_soar_alerts\n            )\n            response_sync_results = update_new_alerts_sync_status(\n                request_sync_results, environments\n            )\n            sync_results = manager.build_new_alert_sync_results_from_response(\n                response_sync_results\n            )\n            soar_failed_count = verify_soar_sync_results(siemplify, sync_results)\n            total_synced += new_alerts_count - soar_failed_count\n\n        siemplify.LOGGER.info(f\"Total of {total_synced} alerts were synced in this run\")\n        siemplify.LOGGER.info(\"--------------- JOB FINISHED ---------------\")\n\n    except Exception as error:\n        siemplify.LOGGER.error(f\"Got exception on main handler. Error: {error}\")\n        siemplify.LOGGER.exception(error)\n        raise\n\n\nif __name__ == \"__main__\":\n    main()\n",
    "author": "89f0bb7e-1996-4922-a989-874601fb6ac7",
    "agent": "",
    "uniqueIdentifier": "39454f2b-f950-4cb6-a1d0-ba2c0a99f211",
    "enabled": false,
    "displayName": "Google Chronicle Alerts Creator Job",
    "description": "This job will sync new SOAR alerts with Chronicle SIEM.\nNote: This job is only supported from Chronicle SOAR version 6.2.30 and higher.",
    "intervalSeconds": 60,
    "advanced": false,
    "advancedConfig": {
        "timeZone": "Europe/London",
        "scheduleType": "Once",
        "oneTimeSchedule": {
            "startDate": {
                "year": 2026,
                "month": 2,
                "day": 21
            },
            "time": {
                "hours": 11,
                "minutes": 14,
                "seconds": 0,
                "nanos": 0
            },
            "interval": 0
        }
    }
}